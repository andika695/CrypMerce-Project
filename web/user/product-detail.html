<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Produk - CrypMerce</title>
    <link rel="stylesheet" href="../assets/css/user/header-dashboard.css?v=2">
    <link rel="stylesheet" href="../assets/css/user/product-detail.css?v=2.1">
    <link rel="stylesheet" href="../assets/css/user/body.css">
    <link rel="stylesheet" href="../assets/css/user/footer.css">
    <link rel="stylesheet" href="../assets/css/user/category-carousel.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="icon" type="image/png" href="../../../assets/images/logo.png">
    <link rel="stylesheet" href="../assets/css/ai-chat.css">
    <!-- midtrans -->
    <script type="text/javascript"
      src="https://app.sandbox.midtrans.com/snap/snap.js"
      data-client-key="Mid-client-3WZHPNbDA-naskBI">
    </script>

</head>
<body>

    <!-- Header / Navbar (Reused) -->
    <header class="header">
        <div class="main-container">
            <div class="header-content">
                <div class="logo">
                    <a href="dashboard.html">
                        <img src="../assets/images/logotesk.png" alt="Logo">
                    </a>
                </div>
                <button class="menu-btn" id="menuBtn">‚ò∞</button>
                
                <!-- Simplified Header for Detail Page -->
                <!-- Desktop Category & Search Wrapper -->
                <div class="search-wrapper">
                     <div class="search-bar">
                        <!-- Category Dropdown Removed -->

                        <input type="search" id="searchInput" placeholder="Cari di CrypMerce">
                        <button class="search-btn" id="searchBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="header-right">
                    <button class="icon-btn" onclick="window.location.href='cart.html'">
                        <img src="../assets/images/bag.png" alt="Bag">
                    </button>

                    <button class="icon-btn" id="notificationBtn">
                        <img src="../assets/images/bell.png" alt="Notif">
                    </button>

                    <button class="akun-btn icon-btn" onclick="window.location.href='profile.php'">
                        <img src="../assets/images/person.png" alt="User">
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="main-container main-content">
        <!-- Breadcrumb / Back Button -->
        <div class="breadcrumb">
            <a href="javascript:history.back()" style="text-decoration: none; color: #4b5563; display: flex; align-items: center; gap: 5px;">
                <i class="fas fa-arrow-left"></i> Kembali
            </a>
        </div>

        <div class="product-detail-grid">
            <!-- Left Column: Images & Seller -->
            <div class="product-left-column">
                <div class="product-gallery">
                    <div class="main-image">
                        <img id="main-img" src="../assets/images/no-image.png" alt="Product Image">
                    </div>
                    <div class="thumbnail-gallery" id="thumbnail-gallery">
                        <!-- Thumbnails will be rendered by JS -->
                    </div>
                </div>

                <!-- Seller Info Widget -->
                <div class="seller-widget">
                    <div class="seller-header">
                        <a id="seller-link" href="#" style="display: flex; align-items: center; gap: 12px; text-decoration: none; color: inherit; flex: 1;">
                            <img id="seller-photo" src="../assets/images/default-avatar.png" alt="Seller">
                            <div class="seller-details">
                                <h3 id="seller-name">Nama Toko</h3>
                                <p class="seller-location">üìç <span id="seller-location">Jakarta</span></p>
                            </div>
                        </a>
                        <button class="btn-follow">Follow</button>
                    </div>
                </div>
            </div>

            <!-- Right Column: Info & Variants -->
            <div class="product-info-section">
                <h1 id="product-name" class="product-title">Memuat Nama Produk...</h1>
                
                <div class="price-section">
                    <h2 id="product-price">Rp 0</h2>
                </div>

                <div class="product-meta">
                    <p>Berat: <span id="product-weight" style="font-weight: 600;">-</span></p>
                    <div id="shipping-cost-container" style="margin-top: 8px; display:none;">
                         <p>Total Ongkir: <span id="shipping-cost" style="font-weight: 600; color: #3533cd;">Memuat...</span></p>
                         <small id="shipping-estimation" style="color: #666; font-size: 0.9em;"></small>
                    </div>
                    <p style="margin-top: 8px;">Stok: <span id="product-stock" style="font-weight: 600;">-</span></p>
                </div>
            </div>
        </div>

        <!-- Bottom Section: Description & Reviews -->
        <div class="product-content-bottom">
            <hr class="section-divider">
            <div class="description-section">
                <h3>Deskripsi Produk</h3>
                <div id="product-description" class="description-content">
                    Memuat deskripsi...
                </div>
            </div>
            
            <div class="reviews-section">
                <h3>Ulasan <span id="review-count"></span></h3>
                <div id="product-reviews">
                     <p>Memuat ulasan...</p>
                </div>
            </div>

            <!-- Store Products Section (Integrated) -->
            <div class="store-products-integrated">
                <hr class="section-divider">
                <div class="category-header" style="margin-bottom: 24px;">
                    <div class="category-title-group">
                        <div class="category-tag">Produk Lainnya</div>
                        <h2 class="category-title">Dari Toko Ini</h2>
                    </div>
                </div>
                <div class="product-grid-6" id="store-products-grid">
                    <p style="text-align:center; color:#888;">Memuat produk...</p>
                </div>
            </div>
        </div>

        <!-- Similar Products Section (Separate Card) -->
        <section class="similar-products-section">
            <div class="category-header" style="margin-bottom: 24px;">
                <div class="category-title-group">
                    <div class="category-tag">Produk Serupa</div>
                    <h2 class="category-title">Produk Kategori Sama</h2>
                </div>
            </div>
            <div class="product-grid-6" id="similar-products-grid">
                <p style="text-align:center; color:#888;">Memuat produk serupa...</p>
            </div>
        </section>
    </div>

    <!-- FOOTER -->
    <footer class="main-footer has-sticky-bar">
        <div class="footer-content">
            <!-- Brand Column -->
            <div class="footer-col">
                <img src="../assets/images/logotesk.png" alt="CrypMerce Logo" class="footer-logo">
                <p class="footer-description">
                    Crypmerce adalah platform e-commerce berbasis web yang mengintegrasikan cryptocurrency sebagai metode pembayaran.
                </p>
                <div class="footer-contact">
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <span>crypmerce@gmail.com</span>
                    </div>
                </div>
            </div>

            <!-- Customer Service -->
            <div class="footer-col">
                <h3 class="footer-heading">Layanan Pelanggan</h3>
                <ul class="footer-links">
                    <li><a href="#">Bantuan</a></li>
                    <li><a href="#payment-methods">Metode Pembayaran</a></li>
                    <li><a href="#">Lacak Pesanan</a></li>
                    <li><a href="#">Hubungi Kami</a></li>
                </ul>
            </div>

            <!-- About -->
            <div class="footer-col">
                <h3 class="footer-heading">Jelajahi</h3>
                <ul class="footer-links">
                    <li><a href="#">Tentang Kami</a></li>
                    <li><a href="#">Kebijakan Privasi</a></li>
                    <li><a href="#">Syarat & Ketentuan</a></li>
                    <li><a href="#">Karir</a></li>
                </ul>
            </div>

            <!-- Social -->
            <div class="footer-col">
                <h3 class="footer-heading">Ikuti Kami</h3>
                <div class="social-links">
                    <a href="#" class="social-btn"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-btn"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-btn"><i class="fab fa-twitter"></i></a>
                    <a href="https://youtu.be/KI4W-9Kdxdo?si=FpilYqKGHnQ54UYb" class="social-btn"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>

        <!-- Payment Methods -->
        <div class="footer-payments" id="payment-methods">
            <h3 class="payment-title">Metode Pembayaran</h3>
            <div class="payment-logos">
                <img src="../assets/images/payment/payment_1_ewallet.png" alt="E-Wallets" class="payment-logo-img" style="height: 35px;">
                <img src="../assets/images/payment/payment_2_cards.png" alt="Credit Cards" class="payment-logo-img" style="height: 35px;">
                <img src="../assets/images/payment/payment_3_banks.png" alt="Bank Transfer" class="payment-logo-img" style="height: 50px;">
                <img src="../assets/images/payment/payment_4_partners.png" alt="Bank Partners" class="payment-logo-img" style="height: 35px;">
                <img src="../assets/images/payment/payment_5_retail.png" alt="Retail" class="payment-logo-img" style="height: 30px;">
                <img src="../assets/images/payment/payment_6_paylater.png" alt="PayLater" class="payment-logo-img" style="height: 30px;">
            </div>

            <h3 class="payment-title" style="margin-top: 25px;">Pembayaran Crypto</h3>
            <div class="payment-logos">
                <img src="../assets/images/payment/payment_crypto_btc.png" alt="Bitcoin" class="payment-logo-img" style="height: 35px;">
                <img src="../assets/images/payment/payment_crypto_eth.png" alt="Ethereum" class="payment-logo-img" style="height: 35px;">
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025-2026 CrypMerce. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- STICKY BOTTOM BAR -->
    <div class="sticky-footer">
        <div class="footer-container">
            <!-- Desktop: Full View -->
            <div class="footer-product-summary">
                <img id="footer-img" src="../assets/images/no-image.png" alt="Mini Product">
                <div class="footer-info">
                    <span id="footer-name">Product Name</span>
                    <span id="footer-price">Rp 0</span>
                </div>
            </div>
            
            <!-- Desktop Actions -->
            <div class="footer-actions desktop-actions">
                <div class="quantity-control">
                    <button onclick="decreaseQty()">-</button>
                    <input type="number" id="qty" value="1" min="1" readonly>
                    <button onclick="increaseQty()">+</button>
                </div>
                
                <div class="total-price-label">
                    Total: <strong id="total-price">Rp 0</strong>
                </div>

                <button class="btn-buy-now">Beli Sekarang</button>
                <button class="btn-add-cart">+ Keranjang</button>
            </div>

            <!-- Mobile Actions: Simplified -->
            <div class="footer-actions mobile-actions">
                <button class="btn-buy-mobile" id="btnBuyMobile">
                    <i class="fas fa-shopping-bag"></i> Beli
                </button>
                <button class="btn-cart-mobile" id="btnCartMobile">
                    <i class="fas fa-cart-plus"></i> Keranjang
                </button>
            </div>
        </div>
    </div>

    <!-- PURCHASE POPUP MODAL (TWO-STEP FLOW) -->
    <div class="purchase-modal-overlay" id="purchaseModal">
        <div class="purchase-modal summary-card" style="max-width: 400px; padding: 24px; position: relative;">
            <button class="modal-close" id="closeModal" style="position: absolute; top: 15px; right: 15px; z-index: 10; border: none; background: #f1f5f9; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #64748b; font-size: 20px;">&times;</button>

            <!-- STEP 1: QUANTITY SELECTION -->
            <div id="modal-step-1" class="modal-step active">
                <div class="modal-header" style="margin-bottom: 20px; border-bottom: none; padding: 0;">
                    <h3 style="font-size: 1.25rem; font-weight: 700; color: #1e293b;">Pilih Jumlah</h3>
                </div>
                
                <div class="modal-product-preview" style="display: flex; gap: 16px; margin-bottom: 24px; padding: 12px; background: #f8fafc; border-radius: 12px;">
                    <img id="modal-prev-img" src="../assets/images/no-image.png" alt="Product" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">
                    <div class="modal-prev-info">
                        <h4 id="modal-prev-name" style="font-size: 1rem; font-weight: 600; color: #1e293b; margin-bottom: 4px;">Nama Produk</h4>
                        <p id="modal-prev-price" style="color: #3533cd; font-weight: 700; font-size: 1.1rem;">Rp 0</p>
                    </div>
                </div>

                <div class="modal-quantity-section" style="margin-bottom: 24px;">
                    <label style="display: block; margin-bottom: 12px; color: #64748b; font-weight: 500;">Jumlah Barang</label>
                    <div class="modal-quantity-control" style="display: flex; align-items: center; gap: 20px; background: #f1f5f9; padding: 8px 16px; border-radius: 12px; width: fit-content;">
                        <button class="qty-btn" id="modalDecreaseQty" style="border: none; background: none; font-size: 1.5rem; color: #3533cd; cursor: pointer; padding: 0 10px;">-</button>
                        <input type="number" id="modalQty" value="1" min="1" readonly style="border: none; background: none; text-align: center; width: 40px; font-weight: 700; font-size: 1.2rem; outline: none;">
                        <button class="qty-btn" id="modalIncreaseQty" style="border: none; background: none; font-size: 1.5rem; color: #3533cd; cursor: pointer; padding: 0 10px;">+</button>
                    </div>
                </div>

                <button id="btnNextStep" style="width: 100%; padding: 14px; border: none; border-radius: 12px; background: #3533cd; color: white; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.2s;">
                    Lanjut ke Ringkasan
                </button>
            </div>

            <!-- STEP 2: SHOPPING SUMMARY -->
            <div id="modal-step-2" class="modal-step" style="display: none;">
                <div class="modal-header" style="margin-bottom: 20px; border-bottom: none; padding: 0;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <button id="btnPrevStep" style="border: none; background: none; color: #64748b; cursor: pointer; font-size: 1.2rem; padding: 0;"><i class="fas fa-arrow-left"></i></button>
                        <h3 style="font-size: 1.25rem; font-weight: 700; color: #1e293b;">Ringkasan Belanja</h3>
                    </div>
                </div>
                
                <div class="summary-details" style="border-top: 1px solid #f1f5f9; border-bottom: 1px solid #f1f5f9; padding: 20px 0; margin-bottom: 24px;">
                    <div class="summary-product-name" style="margin-bottom: 16px;">
                        <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 4px;">Produk</p>
                        <strong id="modal-product-name-summary" style="color: #1e293b; display: block; line-height: 1.4;">Nama Produk</strong>
                    </div>

                    <div class="summary-row" style="display: flex; justify-content: space-between; margin-bottom: 12px; color: #64748b;">
                        <span>Total Produk</span>
                        <strong id="modal-product-count" style="color: #1e293b;">1</strong>
                    </div>
                    
                    <div class="summary-row" style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 600; color: #1e293b; font-size: 1.1rem;">Total Harga</span>
                        <strong id="modal-total-price" style="font-size: 1.5rem; font-weight: 700; color: #3533cd;">Rp 0</strong>
                    </div>
                </div>
                
                <div class="modal-checkout-actions" style="display: flex; flex-direction: column; gap: 12px;">
                    <button class="btn-confirm-purchase midtrans-btn" id="btnConfirmPurchase" style="width: 100%; padding: 14px; border: none; border-radius: 12px; background: #3533cd; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: 600; font-size: 1rem; transition: all 0.2s;">
                        Checkout IDR ( <span class="item-count">1</span> )
                    </button>
                    <button class="btn-confirm-purchase crypto-btn" id="btnConfirmCrypto" style="width: 100%; padding: 14px; border: none; border-radius: 12px; background: #f7931a; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: 600; font-size: 1rem; transition: all 0.2s;">
                        Checkout Crypto ( <span class="item-count">1</span> )
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Crypto Payment Modal -->
    <div id="cryptoPaymentModal" class="modal-overlay" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center;">
        <div class="modal-content crypto-modal-content" style="background: white; border-radius: 12px; width: 90%; max-width: 450px; padding: 20px; position: relative;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Crypto Payment (Simulasi)</h3>
                <button class="close-modal" id="closeCryptoModal" style="border: none; background: none; font-size: 24px; cursor: pointer;">&times;</button>
            </div>
            
            <div class="crypto-selection" style="margin-bottom: 20px;">
                <label for="cryptoSelect" style="display: block; margin-bottom: 8px; font-weight: 500;">Pilih Coin:</label>
                <div class="select-wrapper">
                    <select id="cryptoSelect" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                        <option value="" disabled selected>-- Pilih Coin --</option>
                        <option value="btc">Bitcoin (BTC)</option>
                        <option value="eth">Ethereum (ETH)</option>
                    </select>
                </div>
            </div>

            <div id="cryptoPaymentDetails" class="crypto-details" style="display: none;">
                <div class="qr-container" style="text-align: center; margin-bottom: 20px;">
                    <img id="cryptoQr" src="" alt="QR Code" class="qr-image" style="width: 160px; height: 160px; border: 1px solid #eee; padding: 10px;">
                </div>
                
                <div class="wallet-info" style="margin-bottom: 15px;">
                    <p class="label" style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Alamat Wallet:</p>
                    <div class="wallet-address-box" style="background: #f8fafc; padding: 10px; border-radius: 8px; font-family: monospace; font-size: 0.85em; display: flex; justify-content: space-between; align-items: center;">
                        <span id="walletAddress" style="word-break: break-all;">...</span>
                        <button class="copy-btn" title="Salin" style="border: none; background: none; color: var(--primary); cursor: pointer;"><i class="far fa-copy"></i></button>
                    </div>
                </div>

                <div class="amount-info" style="margin-bottom: 15px;">
                    <p class="label" style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Total Pembayaran:</p>
                    <div class="amount-box" style="background: #f8fafc; padding: 10px; border-radius: 8px; font-weight: 600;">
                        <span id="cryptoAmount">...</span> <span id="cryptoCurrency">BTC</span>
                        <br>
                        <small style="font-weight: 400; color: #666;">(<span id="fiatAmount">Rp ...</span>)</small>
                    </div>
                </div>

                <div class="alert-box" style="background: #fff8eb; border: 1px solid #ffd8a8; padding: 10px; border-radius: 8px; display: flex; gap: 10px; align-items: center; margin-bottom: 20px;">
                    <i class="fas fa-info-circle" style="color: #f7931a;"></i>
                    <p style="font-size: 0.85em; color: #855e28;">Ini hanya simulasi. Klik "Selesai Pembayaran" untuk menyelesaikan pesanan.</p>
                </div>

                <button id="confirmCryptoBtn" class="confirm-btn" style="width: 100%; padding: 12px; border: none; border-radius: 8px; background: #10b981; color: white; font-weight: 600; cursor: pointer;">Selesai Pembayaran</button>
            </div>
        </div>
    </div>

    <!-- Modal Toast/Notification -->
    <div id="toast" class="toast">Berhasil ditambahkan ke keranjang</div>

    <!-- Mobile Category Removed -->

    <script src="../assets/js/user/notifikasi.js?v=2"></script>
    <script src="../assets/js/user/header.js?v=3"></script>
    <script src="../assets/js/user/product-detail.js?v=2.1"></script>
    <script src="../assets/js/ai-chat.js"></script>
</body>
</html>
